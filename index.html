<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –ó–∞–¥–∞—á–∏</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
    <!-- Axios for API requests -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.8/dist/axios.min.js"></script>
    <!-- Font Awesome for icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"></script>
    <!-- Flatpickr for calendar -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.css">
    <style>
        /* Theme styles */
        .dark-theme {
            background: linear-gradient(135deg, #1a0b2e 0%, #2e1a47 50%, #0d1b2a 100%);
            color: #e2e8f0;
        }

        .light-theme {
            background: linear-gradient(135deg, #f3e8ff 0%, #e2e8f4 50%, #dbeafe 100%);
            color: #1f2937;
        }

        .neon-glow {
            box-shadow: 0 0 8px rgba(88, 28, 135, 0.8), 0 0 16px rgba(147, 51, 234, 0.5);
        }

        .neon-pulse:hover {
            animation: neonPulse 1.2s infinite ease-in-out;
        }

        @keyframes neonPulse {
            0% {
                box-shadow: 0 0 8px rgba(236, 72, 153, 0.6), 0 0 16px rgba(236, 72, 153, 0.4);
            }

            50% {
                box-shadow: 0 0 12px rgba(236, 72, 153, 0.9), 0 0 24px rgba(236, 72, 153, 0.6);
            }

            100% {
                box-shadow: 0 0 8px rgba(236, 72, 153, 0.6), 0 0 16px rgba(236, 72, 153, 0.4);
            }
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(147, 51, 234, 0.4);
        }

        .tilt {
            transition: transform 0.2s ease;
        }

        .tilt:hover {
            transform: perspective(1000px) rotateX(5deg) rotateY(5deg);
        }

        /* Animations */
        .task-enter {
            opacity: 0;
            transform: translateY(20px);
        }

        .task-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }

        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }

        .modal-exit-active {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .toast-enter {
            opacity: 0;
            transform: translateX(100%);
        }

        .toast-enter-active {
            opacity: 1;
            transform: translateX(0);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .toast-exit {
            opacity: 1;
            transform: translateX(0);
        }

        .toast-exit-active {
            opacity: 0;
            transform: translateX(100%);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .shake {
            animation: shake 0.3s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        /* Spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #a855f7;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Category badges */
        .category-work {
            background: #3b82f6;
        }

        .category-personal {
            background: #10b981;
        }

        .category-urgent {
            background: #ef4444;
        }

        /* Flatpickr custom styles */
        .flatpickr-calendar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e2e8f0;
            z-index: 1000;
            width: 100%;
            max-width: 340px;
            margin: auto;
        }

        .flatpickr-day {
            color: #e2e8f0;
            background: transparent;
            border: 1px solid transparent;
        }

        .flatpickr-day:hover,
        .flatpickr-day:focus {
            background: rgba(147, 51, 234, 0.3);
            border-color: #a855f7;
        }

        .flatpickr-day.selected {
            background: #a855f7;
            border-color: #a855f7;
            color: #ffffff;
        }

        .flatpickr-day.today {
            border-color: #10b981;
            color: #10b981;
        }

        .flatpickr-monthDropdown-months,
        .flatpickr-current-month {
            color: #e2e8f0;
        }

        .flatpickr-weekdays {
            color: #e2e8f0;
        }

        .flatpickr-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e2e8f0;
            width: 100%;
            padding: 1rem;
            border-radius: 0.75rem;
        }

        .flatpickr-input:focus {
            outline: none;
            border-color: #a855f7;
            box-shadow: 0 0 8px rgba(147, 51, 234, 0.6);
        }

        .light-theme .flatpickr-calendar {
            background: rgba(255, 255, 255, 0.3);
            color: #1f2937;
        }

        .light-theme .flatpickr-day {
            color: #1f2937;
        }

        .light-theme .flatpickr-day:hover,
        .light-theme .flatpickr-day:focus {
            background: rgba(147, 51, 234, 0.2);
        }

        .light-theme .flatpickr-day.selected {
            background: #a855f7;
            color: #ffffff;
        }

        .light-theme .flatpickr-day.today {
            border-color: #10b981;
            color: #10b981;
        }

        .light-theme .flatpickr-monthDropdown-months,
        .light-theme .flatpickr-current-month {
            color: #1f2937;
        }

        .light-theme .flatpickr-weekdays {
            color: #1f2937;
        }

        .light-theme .flatpickr-input {
            background: rgba(255, 255, 255, 0.3);
            color: #1f2937;
            border-color: rgba(0, 0, 0, 0.1);
        }

        .light-theme .flatpickr-input:focus {
            border-color: #a855f7;
            box-shadow: 0 0 8px rgba(147, 51, 234, 0.4);
        }
    </style>
</head>

<body className="dark-theme min-h-screen font-sans">
    <div id="root" class="container mx-auto p-6"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [tasks, setTasks] = useState([]);
            const [newTask, setNewTask] = useState({ title: '', description: '', completed: false, category: '', due_date: '' });
            const [editingTask, setEditingTask] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [error, setError] = useState('');
            const [toast, setToast] = useState({ message: '', type: '', visible: false });
            const [theme, setTheme] = useState(localStorage.getItem('theme') || 'dark');
            const [filter, setFilter] = useState('all');
            const [search, setSearch] = useState('');
            const [sortBy, setSortBy] = useState('id');
            const [isLoading, setIsLoading] = useState(false);
            const [selectedDate, setSelectedDate] = useState('');
            const [isDateModalOpen, setIsDateModalOpen] = useState(false);
            const calendarRef = useRef(null);
            const datePickerRef = useRef(null);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            useEffect(() => {
                if (calendarRef.current) {
                    flatpickr(calendarRef.current, {
                        onChange: (selectedDates) => {
                            if (selectedDates.length > 0) {
                                const date = new Date(selectedDates[0]);
                                const year = date.getFullYear();
                                const month = String(date.getMonth() + 1).padStart(2, '0');
                                const day = String(date.getDate()).padStart(2, '0');
                                setSelectedDate(`${year}-${month}-${day}`);
                                setIsDateModalOpen(true);
                            }
                        },
                        dateFormat: 'Y-m-d',
                        inline: true,
                        theme: theme === 'dark' ? 'dark' : 'light'
                    });
                }
            }, [theme]);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–µ
            useEffect(() => {
                if (datePickerRef.current) {
                    flatpickr(datePickerRef.current, {
                        dateFormat: 'Y-m-d',
                        onChange: (selectedDates) => {
                            if (selectedDates.length > 0) {
                                const date = new Date(selectedDates[0]);
                                const year = date.getFullYear();
                                const month = String(date.getMonth() + 1).padStart(2, '0');
                                const day = String(date.getDate()).padStart(2, '0');
                                setNewTask({ ...newTask, due_date: `${year}-${month}-${day}` });
                            } else {
                                setNewTask({ ...newTask, due_date: '' });
                            }
                        },
                        theme: theme === 'dark' ? 'dark' : 'light'
                    });
                }
            }, [theme, newTask]);

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –∏ —Ç–µ–º—ã
            useEffect(() => {
                fetchTasks();
                document.body.className = `${theme}-theme min-h-screen font-sans`;
                localStorage.setItem('theme', theme);
            }, [theme]);

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á
            const fetchTasks = async () => {
                setIsLoading(true);
                try {
                    const response = await axios.get('http://127.0.0.1:8000/tasks/');
                    setTasks(response.data);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error);
                    showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞—á–∏', 'error');
                } finally {
                    setIsLoading(false);
                }
            };

            // –°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!newTask.title) {
                    setError('–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ');
                    showToast('–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ', 'error');
                    return;
                }
                const task = {
                    title: newTask.title,
                    description: newTask.description || null,
                    completed: newTask.completed,
                    category: newTask.category || null,
                    due_date: newTask.due_date || null
                };

                setIsLoading(true);
                try {
                    if (editingTask) {
                        task.id = editingTask.id;
                        await axios.put(`http://127.0.0.1:8000/tasks/${task.id}`, task);
                        setTasks(tasks.map(t => t.id === task.id ? task : t));
                        setEditingTask(null);
                        setIsModalOpen(false);
                        showToast('–ó–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
                    } else {
                        const response = await axios.post('http://127.0.0.1:8000/tasks/', task);
                        setTasks([...tasks, response.data]);
                        showToast('–ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
                    }
                    setNewTask({ title: '', description: '', completed: false, category: '', due_date: '' });
                    setError('');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:', error);
                    showToast(error.response?.data?.detail || '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫', 'error');
                } finally {
                    setIsLoading(false);
                }
            };

            // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
            const deleteTask = async (id) => {
                setIsLoading(true);
                try {
                    await axios.delete(`http://127.0.0.1:8000/tasks/${id}`);
                    setTasks(tasks.filter(task => task.id !== id));
                    showToast('–ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:', error);
                    showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É', 'error');
                } finally {
                    setIsLoading(false);
                }
            };

            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
            const editTask = (task) => {
                setEditingTask(task);
                setNewTask({ ...task, due_date: task.due_date || '' });
                setIsModalOpen(true);
                setError('');
            };

            // –û—Ç–º–µ—Ç–∫–∞ –∑–∞–¥–∞—á–∏ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π
            const toggleComplete = async (task) => {
                const updatedTask = { ...task, completed: !task.completed };
                setIsLoading(true);
                try {
                    await axios.put(`http://127.0.0.1:8000/tasks/${task.id}`, updatedTask);
                    setTasks(tasks.map(t => t.id === task.id ? updatedTask : t));
                    showToast(`–ó–∞–¥–∞—á–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ ${updatedTask.completed ? '–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è' : '–Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è'}`, 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:', error);
                    showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É', 'error');
                } finally {
                    setIsLoading(false);
                }
            };

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
            const closeModal = () => {
                setEditingTask(null);
                setNewTask({ title: '', description: '', completed: false, category: '', due_date: '' });
                setIsModalOpen(false);
                setError('');
            };

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –¥–∞—Ç—ã
            const closeDateModal = () => {
                setIsDateModalOpen(false);
                setSelectedDate('');
            };

            // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const showToast = (message, type) => {
                setToast({ message, type, visible: true });
                setTimeout(() => setToast({ ...toast, visible: false }), 3000);
            };

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
            const toggleTheme = () => {
                setTheme(theme === 'dark' ? 'light' : 'dark');
            };

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
            const filteredTasks = tasks
                .filter(task => {
                    if (filter === 'active') return !task.completed;
                    if (filter === 'completed') return task.completed;
                    return true;
                })
                .filter(task => {
                    const searchLower = search.toLowerCase();
                    return (
                        task.title.toLowerCase().includes(searchLower) ||
                        (task.description && task.description.toLowerCase().includes(searchLower)) ||
                        (task.category && task.category.toLowerCase().includes(searchLower))
                    );
                })
                .sort((a, b) => {
                    if (sortBy === 'id') return a.id - b.id;
                    if (sortBy === 'title') return a.title.localeCompare(b.title);
                    if (sortBy === 'status') return a.completed - b.completed;
                    return 0;
                });

            // –ó–∞–¥–∞—á–∏ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç–µ
            const dateTasks = tasks.filter(task => task.due_date === selectedDate);

            return (
                <div className="max-w-4xl mx-auto">
                    <div className="flex justify-between items-center mb-10">
                        <h1 className="text-5xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 via-pink-500 to-cyan-400 animate-pulse">
                            –ú–æ–∏ –ó–∞–¥–∞—á–∏
                        </h1>
                        <button
                            onClick={toggleTheme}
                            className="p-3 rounded-full bg-gradient-to-r from-purple-500 to-cyan-500 neon-pulse transition-transform duration-200 hover:scale-110"
                            title={theme === 'dark' ? '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É' : '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ç—ë–º–Ω—É—é —Ç–µ–º—É'}
                        >
                            <i className={`fas ${theme === 'dark' ? 'fa-sun' : 'fa-moon'} text-white`}></i>
                        </button>
                    </div>

                    {/* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */}
                    <div className={`glass p-6 rounded-2xl mb-6 neon-glow ${theme === 'light' ? 'bg-white/10 border-gray-200/20' : ''}`}>
                        <h2 className={`text-2xl font-semibold mb-4 ${theme === 'light' ? 'text-gray-800' : 'text-cyan-300'}`}>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h2>
                        <div ref={calendarRef} className="flatpickr-calendar"></div>
                    </div>

                    {/* –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ */}
                    <div className={`glass p-6 rounded-2xl mb-6 neon-glow ${theme === 'light' ? 'bg-white/10 border-gray-200/20' : ''}`}>
                        <div className="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                            <select
                                value={filter}
                                onChange={(e) => setFilter(e.target.value)}
                                className={`p-3 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400`}
                            >
                                <option value="all">–í—Å–µ –∑–∞–¥–∞—á–∏</option>
                                <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                                <option value="completed">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</option>
                            </select>
                            <div className="flex flex-1 space-x-2">
                                <input
                                    type="text"
                                    placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –æ–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏..."
                                    value={search}
                                    onChange={(e) => setSearch(e.target.value)}
                                    className={`flex-1 p-3 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400`}
                                />
                                <button
                                    onClick={() => setSearch(search)}
                                    className={`p-3 bg-gradient-to-r from-purple-500 to-cyan-500 text-white rounded-xl neon-pulse transition-transform duration-200 hover:scale-105`}
                                >
                                    <i className="fas fa-search"></i>
                                </button>
                            </div>
                            <select
                                value={sortBy}
                                onChange={(e) => setSortBy(e.target.value)}
                                className={`p-3 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400`}
                            >
                                <option value="id">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ ID</option>
                                <option value="title">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                                <option value="status">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Å—Ç–∞—Ç—É—Å—É</option>
                            </select>
                        </div>
                    </div>

                    {/* –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ */}
                    <div className={`glass p-8 rounded-2xl mb-10 neon-glow transition-transform duration-500 transform hover:scale-105 ${theme === 'light' ? 'bg-white/10 border-gray-200/20' : ''}`}>
                        <h2 className={`text-2xl font-semibold mb-6 ${theme === 'light' ? 'text-gray-800' : 'text-cyan-300'}`}>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h2>
                        {error && <p className="text-red-400 mb-4 shake">{error}</p>}
                        <div className="space-y-5">
                            <input
                                type="text"
                                placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"
                                value={newTask.title}
                                onChange={(e) => setNewTask({ ...newTask, title: e.target.value })}
                                className={`w-full p-4 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400 ${error && !newTask.title ? 'shake border-red-500' : ''}`}
                            />
                            <textarea
                                placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                                value={newTask.description}
                                onChange={(e) => setNewTask({ ...newTask, description: e.target.value })}
                                className={`w-full p-4 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400`}
                            ></textarea>
                            <select
                                value={newTask.category}
                                onChange={(e) => setNewTask({ ...newTask, category: e.target.value })}
                                className={`w-full p-4 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400`}
                            >
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                <option value="work">–†–∞–±–æ—Ç–∞</option>
                                <option value="personal">–õ–∏—á–Ω–æ–µ</option>
                                <option value="urgent">–°—Ä–æ—á–Ω–æ</option>
                            </select>
                            <div className="relative">
                                <input
                                    ref={datePickerRef}
                                    type="text"
                                    placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"
                                    value={newTask.due_date}
                                    readOnly
                                    className={`w-full p-4 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400`}
                                />
                                <i className="fas fa-calendar-alt absolute right-4 top-1/2 transform -translate-y-1/2 text-purple-400"></i>
                            </div>
                            <button
                                onClick={handleSubmit}
                                disabled={isLoading}
                                className={`w-full bg-gradient-to-r from-purple-500 to-cyan-500 text-white p-4 rounded-xl neon-pulse transition-transform duration-200 hover:scale-105 ${isLoading ? 'opacity-50 cursor-not-allowed' : ''}`}
                            >
                                <i className="fas fa-plus mr-2"></i> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
                            </button>
                        </div>
                    </div>

                    {/* –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á */}
                    {isLoading ? (
                        <div className="spinner"></div>
                    ) : filteredTasks.length === 0 && search ? (
                        <div className="text-center text-gray-300 animate-pulse">
                            <p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É "{search}"</p>
                        </div>
                    ) : (
                        <div className="space-y-6">
                            {filteredTasks.map(task => (
                                <div
                                    key={task.id}
                                    className={`p-6 rounded-2xl ${task.completed ? 'bg-green-900/20' : 'glass'} neon-glow tilt task-enter task-enter-active ${theme === 'light' ? 'bg-white/10 border-gray-200/20' : ''}`}
                                >
                                    <div className="flex justify-between items-center">
                                        <h3 className={`text-xl font-semibold ${theme === 'light' ? 'text-gray-800' : 'text-cyan-200'}`}>{task.title} (ID: {task.id})</h3>
                                        {task.category && (
                                            <span className={`px-3 py-1 rounded-full text-sm text-white category-${task.category}`}>
                                                {task.category === 'work' ? 'üíº –†–∞–±–æ—Ç–∞' : task.category === 'personal' ? 'üè° –õ–∏—á–Ω–æ–µ' : 'üî• –°—Ä–æ—á–Ω–æ'}
                                            </span>
                                        )}
                                    </div>
                                    <p className={`text-gray-300 mt-1 ${theme === 'light' ? 'text-gray-600' : ''}`}>{task.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                                    <p className={`text-sm mt-2 ${theme === 'light' ? 'text-gray-500' : 'text-gray-400'}`}>–°—Ç–∞—Ç—É—Å: {task.completed ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ ‚úÖ' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ'}</p>
                                    {task.due_date && (
                                        <p className={`text-sm mt-2 ${theme === 'light' ? 'text-gray-500' : 'text-gray-400'}`}>–°—Ä–æ–∫: {task.due_date}</p>
                                    )}
                                    <div className="mt-4 flex space-x-4">
                                        <button
                                            onClick={() => toggleComplete(task)}
                                            className="bg-yellow-500 text-white px-5 py-2 rounded-xl neon-pulse transition-transform duration-200 hover:scale-110"
                                        >
                                            <i className={`fas ${task.completed ? 'fa-undo' : 'fa-check'} mr-2`}></i>
                                            {task.completed ? '–û—Ç–º–µ–Ω–∏—Ç—å' : '–û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π'}
                                        </button>
                                        <button
                                            onClick={() => editTask(task)}
                                            className="bg-cyan-500 text-white px-5 py-2 rounded-xl neon-pulse transition-transform duration-200 hover:scale-110"
                                        >
                                            <i className="fas fa-edit mr-2"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                        </button>
                                        <button
                                            onClick={() => deleteTask(task.id)}
                                            className="bg-red-500 text-white px-5 py-2 rounded-xl neon-pulse transition-transform duration-200 hover:scale-110"
                                        >
                                            <i className="fas fa-trash mr-2"></i> –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */}
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center modal-enter modal-enter-active z-50">
                            <div className={`glass p-8 rounded-2xl w-full max-w-md neon-glow ${theme === 'light' ? 'bg-white/10 border-gray-200/20' : ''}`}>
                                <h2 className={`text-2xl font-semibold mb-6 ${theme === 'light' ? 'text-gray-800' : 'text-cyan-300'}`}>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É</h2>
                                {error && <p className="text-red-400 mb-4 shake">{error}</p>}
                                <div className="space-y-5">
                                    <input
                                        type="text"
                                        value={`ID: ${newTask.id}`}
                                        disabled
                                        className={`w-full p-4 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'}`}
                                    />
                                    <input
                                        type="text"
                                        placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"
                                        value={newTask.title}
                                        onChange={(e) => setNewTask({ ...newTask, title: e.target.value })}
                                        className={`w-full p-4 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400 ${error && !newTask.title ? 'shake border-red-500' : ''}`}
                                    />
                                    <textarea
                                        placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                                        value={newTask.description}
                                        onChange={(e) => setNewTask({ ...newTask, description: e.target.value })}
                                        className={`w-full p-4 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400`}
                                    ></textarea>
                                    <select
                                        value={newTask.category}
                                        onChange={(e) => setNewTask({ ...newTask, category: e.target.value })}
                                        className={`w-full p-4 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400`}
                                    >
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                        <option value="work">–†–∞–±–æ—Ç–∞</option>
                                        <option value="personal">–õ–∏—á–Ω–æ–µ</option>
                                        <option value="urgent">–°—Ä–æ—á–Ω–æ</option>
                                    </select>
                                    <div className="relative">
                                        <input
                                            ref={datePickerRef}
                                            type="text"
                                            placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"
                                            value={newTask.due_date}
                                            readOnly
                                            className={`w-full p-4 bg-gray-900/50 border border-purple-500/30 rounded-xl ${theme === 'light' ? 'bg-gray-200/50 text-gray-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-cyan-400`}
                                        />
                                        <i className="fas fa-calendar-alt absolute right-4 top-1/2 transform -translate-y-1/2 text-purple-400"></i>
                                    </div>
                                    <div className="flex space-x-4">
                                        <button
                                            onClick={handleSubmit}
                                            disabled={isLoading}
                                            className={`flex-1 bg-gradient-to-r from-purple-500 to-cyan-500 text-white p-4 rounded-xl neon-pulse transition-transform duration-200 hover:scale-105 ${isLoading ? 'opacity-50 cursor-not-allowed' : ''}`}
                                        >
                                            <i className="fas fa-save mr-2"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                        </button>
                                        <button
                                            onClick={closeModal}
                                            className={`flex-1 bg-gray-600/50 text-white p-4 rounded-xl neon-pulse transition-transform duration-200 hover:scale-105 ${theme === 'light' ? 'bg-gray-300/50 text-gray-800' : ''}`}
                                        >
                                            <i className="fas fa-times mr-2"></i> –û—Ç–º–µ–Ω–∞
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞–¥–∞—á –ø–æ –¥–∞—Ç–µ */}
                    {isDateModalOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center modal-enter modal-enter-active z-50">
                            <div className={`glass p-8 rounded-2xl w-full max-w-md neon-glow ${theme === 'light' ? 'bg-white/10 border-gray-200/20' : ''}`}>
                                <h2 className={`text-2xl font-semibold mb-6 ${theme === 'light' ? 'text-gray-800' : 'text-cyan-300'}`}>–ó–∞–¥–∞—á–∏ –Ω–∞ {selectedDate}</h2>
                                {dateTasks.length === 0 ? (
                                    <p className={`text-gray-300 ${theme === 'light' ? 'text-gray-600' : ''}`}>–ù–µ—Ç –∑–∞–¥–∞—á –Ω–∞ —ç—Ç—É –¥–∞—Ç—É</p>
                                ) : (
                                    <div className="space-y-4">
                                        {dateTasks.map(task => (
                                            <div key={task.id} className={`p-4 rounded-xl ${task.completed ? 'bg-green-900/20' : 'bg-gray-900/50'} ${theme === 'light' ? 'bg-gray-200/30' : ''}`}>
                                                <div className="flex justify-between items-center">
                                                    <h3 className={`text-lg font-semibold ${theme === 'light' ? 'text-gray-800' : 'text-cyan-200'}`}>{task.title} (ID: {task.id})</h3>
                                                    {task.category && (
                                                        <span className={`px-2 py-1 rounded-full text-xs text-white category-${task.category}`}>
                                                            {task.category === 'work' ? 'üíº –†–∞–±–æ—Ç–∞' : task.category === 'personal' ? 'üè° –õ–∏—á–Ω–æ–µ' : 'üî• –°—Ä–æ—á–Ω–æ'}
                                                        </span>
                                                    )}
                                                </div>
                                                <p className={`text-sm ${theme === 'light' ? 'text-gray-600' : 'text-gray-300'}`}>{task.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                                                <p className={`text-sm ${theme === 'light' ? 'text-gray-500' : 'text-gray-400'}`}>–°—Ç–∞—Ç—É—Å: {task.completed ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ ‚úÖ' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ'}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                <button
                                    onClick={closeDateModal}
                                    className={`w-full mt-6 bg-gray-600/50 text-white p-4 rounded-xl neon-pulse transition-transform duration-200 hover:scale-105 ${theme === 'light' ? 'bg-gray-300/50 text-gray-800' : ''}`}
                                >
                                    <i className="fas fa-times mr-2"></i> –ó–∞–∫—Ä—ã—Ç—å
                                </button>
                            </div>
                        </div>
                    )}

                    {/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */}
                    {toast.visible && (
                        <div className={`fixed bottom-4 right-4 p-4 rounded-xl ${toast.type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white neon-glow toast-enter toast-enter-active z-50`}>
                            <i className={`fas ${toast.type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2`}></i>
                            {toast.message}
                        </div>
                    )}
                </div>
            );
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>